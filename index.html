<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>Beat Visual: VIBE SELECTOR</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;800&family=Noto+Sans+KR:wght@300;500;700&display=swap');

        /* [ê¸°ë³¸ ë ˆì´ì•„ì›ƒ] */
        body { background-color: #000; margin: 0; padding: 0; font-family: 'Montserrat', 'Noto Sans KR', sans-serif; width: 100%; overflow-x: hidden; overflow-y: auto; }
        section { width: 100%; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; box-sizing: border-box; padding: 60px 20px; }

        /* ë¡œê·¸ì¸ UI ìŠ¤íƒ€ì¼ */
        #auth-container { position: absolute; top: 20px; right: 20px; z-index: 1000; display: flex; align-items: center; gap: 15px; }
        .login-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.5); color: #fff; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; transition: 0.3s; display: flex; align-items: center; gap: 8px; }
        .login-btn:hover { background: #fff; color: #000; }
        .google-icon { width: 18px; height: 18px; }
        
        /* ë¡œê·¸ì¸ í›„ í”„ë¡œí•„ ìŠ¤íƒ€ì¼ */
        #user-profile { display: none; align-items: center; gap: 10px; background: rgba(0, 0, 0, 0.6); padding: 5px 15px 5px 5px; border-radius: 30px; border: 1px solid #333; }
        .profile-pic { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #00dbde; }
        .user-name { color: #fff; font-size: 14px; font-weight: bold; margin-right: 5px; }
        .logout-btn { font-size: 12px; color: #888; cursor: pointer; text-decoration: underline; background: none; border: none; padding: 0; }
        .logout-btn:hover { color: #ff00de; }

        /* SECTION 1: ë©”ì¸ ì—…ë¡œë” */
        #main-section { background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%); z-index: 10; }
        .container { background-color: rgba(0, 0, 0, 0.85); backdrop-filter: blur(12px); padding: 40px; border-radius: 20px; text-align: center; width: 480px; max-width: 90%; border: 1px solid rgba(255, 255, 255, 0.15); z-index: 100; position: relative; box-shadow: 0 0 60px rgba(0,0,0,0.8); }
        h1 { margin: 0 0 10px 0; font-size: 32px; color: #fff; font-weight: 800; letter-spacing: 3px; text-shadow: 0 0 15px rgba(255, 255, 255, 0.5); }
        p { color: #888; margin-bottom: 30px; font-size: 13px; text-transform: uppercase; letter-spacing: 2px; }
        
        input[type="file"] { width: 100%; padding: 15px; margin-bottom: 25px; background: #1a1a1a; border: 1px solid #333; border-radius: 10px; color: #ccc; cursor: pointer; box-sizing: border-box; font-size: 14px; text-align: center; }
        
        .theme-label { text-align: left; color: #fff; font-size: 12px; font-weight: bold; margin-bottom: 12px; display: block; }
        .theme-selector { display: flex; gap: 10px; margin-bottom: 30px; }
        .theme-option { flex: 1; position: relative; }
        .theme-option input { position: absolute; opacity: 0; cursor: pointer; }
        
        .theme-card { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 80px; background: #222; border: 1px solid #444; border-radius: 10px; cursor: pointer; transition: 0.3s; color: #666; }
        .theme-icon { font-size: 24px; margin-bottom: 5px; }
        .theme-name { font-size: 10px; font-weight: bold; }
        
        /* ë¼ë””ì˜¤ ë²„íŠ¼ ì„ íƒ ì‹œ ìŠ¤íƒ€ì¼ */
        .theme-option input:checked + .theme-card { background: linear-gradient(135deg, #222, #333); border-color: #00dbde; color: #fff; box-shadow: 0 0 20px rgba(0, 219, 222, 0.3); }
        
        /* 1. Sunset (Pink) */
        .theme-option:nth-child(1) input:checked + .theme-card { border-color: #ff00de; box-shadow: 0 0 20px rgba(255, 0, 222, 0.4); }
        /* 2. Studio (Blue) */
        .theme-option:nth-child(2) input:checked + .theme-card { border-color: #00dbde; box-shadow: 0 0 20px rgba(0, 219, 222, 0.4); }
        /* 3. Video (Green) */
        .theme-option:nth-child(3) input:checked + .theme-card { border-color: #00ff00; box-shadow: 0 0 20px rgba(0, 255, 0, 0.4); }

        /* í”„ë¡¬í”„íŠ¸ ì…ë ¥ ì„¹ì…˜ */
        #sub-style-section { display: none; margin-bottom: 30px; animation: fadeIn 0.5s; text-align: left; }
        .sub-label { color: #00ff00; font-size: 11px; font-weight: bold; margin-bottom: 8px; display: block; letter-spacing: 1px; }
        #video-prompt { 
            width: 100%; 
            padding: 15px; 
            background: rgba(0, 255, 0, 0.05); 
            border: 1px solid #00ff00; 
            border-radius: 10px; 
            color: #fff; 
            box-sizing: border-box; 
            font-family: inherit;
            font-size: 13px; 
            resize: none; 
            outline: none; 
            transition: 0.3s; 
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.1);
        }
        #video-prompt:focus {
            background: rgba(0, 255, 0, 0.1);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.4);
        }
        #video-prompt::placeholder { color: #555; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .submit-btn { background: #fff; color: #000; border: none; border-radius: 10px; padding: 16px; width: 100%; font-weight: 800; font-size: 16px; text-transform: uppercase; cursor: pointer; transition: 0.2s; }
        .submit-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(255, 255, 255, 0.3); }

        .scroll-hint { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); color: rgba(255,255,255,0.3); font-size: 12px; letter-spacing: 3px; animation: bounce 2s infinite; text-align: center; cursor: pointer; }
        .scroll-hint span { display: block; font-size: 20px; margin-top: 10px; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);} 40% {transform: translateX(-50%) translateY(-10px);} 60% {transform: translateX(-50%) translateY(-5px);} }

        /* SECTION 2: í…Œë§ˆ ì†Œê°œ */
        #info-section { background-color: #080808; }
        .info-title { font-size: 32px; color: #fff; font-weight: 800; margin-bottom: 60px; border-bottom: 3px solid #00dbde; padding-bottom: 20px; letter-spacing: 2px; text-align: center; }
        .info-title span { color: #00dbde; }
        .cards-wrapper { display: flex; gap: 30px; max-width: 1400px; width: 90%; justify-content: center; flex-wrap: wrap; }
        
        .info-card { flex: 1; min-width: 300px; max-width: 400px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; overflow: hidden; transition: 0.4s; display: flex; flex-direction: column; }
        .info-card:hover { transform: translateY(-10px); background: rgba(255, 255, 255, 0.05); }
        
        .card-sunset:hover { border-color: #ff00de; box-shadow: 0 10px 30px rgba(255, 0, 222, 0.2); }
        .card-studio:hover { border-color: #00dbde; box-shadow: 0 10px 30px rgba(0, 219, 222, 0.2); } 
        .card-video:hover { border-color: #00ff00; box-shadow: 0 10px 30px rgba(0, 255, 0, 0.2); }

        .card-image { height: 220px; width: 100%; position: relative; overflow: hidden; }
        .static-bg { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        
        .img-sunset { background: linear-gradient(to bottom, #2b002b, #ff00de); } 
        .img-studio { background: linear-gradient(to bottom, #0f172a, #00dbde); } 
        .img-video { background: linear-gradient(to bottom, #001a00, #00ff00); }
        
        .gif-preview { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 2; opacity: 1; }
        
        .card-content { padding: 30px; text-align: left; flex-grow: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 22px; font-weight: 800; color: #fff; margin-bottom: 15px; letter-spacing: 1px; }
        .card-desc { font-size: 14px; color: #ccc; line-height: 1.6; margin-bottom: 25px; flex-grow: 1; word-break: keep-all; }
        .hashtags { font-size: 12px; font-weight: 700; opacity: 0.8; margin-top: auto; letter-spacing: 1px; }
        
        .hash-sunset { color: #ff00de; } 
        .hash-studio { color: #00dbde; } 
        .hash-video { color: #00ff00; }

        /* SECTION 3: íŒ€ì› ì†Œê°œ */
        #team-section { background-color: #050505; }
        .team-header { margin-bottom: 60px; text-align: center; }
        .team-sub { font-size: 14px; color: #666; margin-bottom: 8px; letter-spacing: 3px; font-weight: bold; }
        .team-main-title { font-size: 36px; color: #fff; font-weight: 900; letter-spacing: 2px; }
        .team-main-title span { color: #fff; border-bottom: 4px solid #00dbde; padding-bottom: 10px; }
        .team-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 40px; max-width: 1200px; width: 90%; }
        .member-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 30px; display: flex; align-items: center; transition: 0.3s; position: relative; overflow: hidden; }
        .member-card:hover { transform: translateX(10px); background: rgba(255, 255, 255, 0.06); }
        .card-cicd:hover { border-color: #ffaa00; box-shadow: 0 0 20px rgba(255, 170, 0, 0.1); }
        .card-analyze:hover { border-color: #00ff00; box-shadow: 0 0 20px rgba(0, 255, 0, 0.1); }
        .card-db:hover { border-color: #00aaff; box-shadow: 0 0 20px rgba(0, 170, 255, 0.1); }
        .card-web:hover { border-color: #ff00de; box-shadow: 0 0 20px rgba(255, 0, 222, 0.1); }
        .member-avatar { width: 80px; height: 80px; background: #222; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 25px; border: 2px solid #333; font-size: 32px; flex-shrink: 0; transition: 0.3s; }
        .member-info { text-align: left; width: 100%; }
        .member-name { font-size: 24px; font-weight: 800; color: #fff; margin-bottom: 5px; }
        .member-role { font-size: 13px; font-weight: 700; margin-bottom: 10px; letter-spacing: 1px; text-transform: uppercase; }
        .member-contact { font-size: 13px; color: #888; font-family: 'Courier New', monospace; display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        .member-contact a { color: #888; text-decoration: none; transition: 0.2s; }
        .member-contact a:hover { color: #fff; text-decoration: underline; }
        .role-cicd { color: #ffaa00; } .role-analyze { color: #00ff00; } .role-db { color: #00aaff; } .role-web { color: #ff00de; }
        .card-cicd:hover .member-avatar { border-color: #ffaa00; color: #ffaa00; box-shadow: 0 0 20px rgba(255, 170, 0, 0.3); }
        .card-analyze:hover .member-avatar { border-color: #00ff00; color: #00ff00; box-shadow: 0 0 20px rgba(0, 255, 0, 0.3); }
        .card-db:hover .member-avatar { border-color: #00aaff; color: #00aaff; box-shadow: 0 0 20px rgba(0, 170, 255, 0.3); }
        .card-web:hover .member-avatar { border-color: #ff00de; color: #ff00de; box-shadow: 0 0 20px rgba(255, 0, 222, 0.3); }

        /* ë¡œë”© í™”ë©´ */
        #loading-section { position: fixed; top:0; left:0; width: 100%; height: 100%; z-index: 9999; background: #000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .loader-text { color: #fff; font-size: 24px; font-weight: bold; letter-spacing: 4px; margin-bottom: 30px; animation: blink 1s infinite; }
        .progress-container { width: 400px; height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
        .progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #ff00de, #00dbde); transition: width 0.1s linear; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        ::-webkit-scrollbar { width: 10px; } ::-webkit-scrollbar-track { background: #111; } ::-webkit-scrollbar-thumb { background: #444; border-radius: 5px; } ::-webkit-scrollbar-thumb:hover { background: #666; }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
        @media screen and (max-width: 768px) {
            section { padding: 80px 15px 40px 15px; }
            #auth-container { top: 15px; right: 15px; }
            .login-btn { padding: 8px 12px; font-size: 12px; }
            .google-icon { width: 14px; height: 14px; }
            #user-profile { padding: 3px 10px 3px 3px; }
            .user-name { font-size: 12px; display: none; }
            .container { width: 100%; max-width: 100%; padding: 25px 20px; margin-top: 40px; }
            h1 { font-size: 24px; letter-spacing: 1px; }
            p { font-size: 11px; margin-bottom: 20px; }
            .theme-selector { flex-direction: column; gap: 8px; }
            .theme-card { height: 60px; flex-direction: row; justify-content: flex-start; align-items: center; padding-left: 20px; gap: 15px; }
            .theme-icon { margin-bottom: 0; font-size: 20px; }
            .theme-name { font-size: 12px; }
            .cards-wrapper { flex-direction: column; gap: 20px; }
            .info-card { min-width: 100%; max-width: 100%; }
            .card-image { height: 180px; }
            .team-grid { grid-template-columns: 1fr; gap: 20px; }
            .member-card { flex-direction: column; text-align: center; padding: 25px; }
            .member-avatar { margin-right: 0; margin-bottom: 15px; width: 70px; height: 70px; font-size: 28px; }
            .member-info { text-align: center; }
            .member-contact { justify-content: center; font-size: 12px; }
            .team-main-title { font-size: 26px; }
        }
    </style>
</head>
<body>

    <div id="auth-container">
        <button id="google-login-btn" class="login-btn">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="google-icon" alt="G">
            LOGIN
        </button>
        <div id="user-profile">
            <img id="user-pic" src="" alt="Profile" class="profile-pic">
            <span id="user-name" class="user-name"></span>
            <button id="logout-btn" class="logout-btn">LOGOUT</button>
        </div>
    </div>

    <section id="main-section">
        <div class="container">
            <h1>BEAT VISUAL</h1>
            <p>Select your vibe & Play</p>
            
            <form id="uploadForm" onsubmit="handleUpload(event)">
                <input type="file" id="fileInput" name="file" accept="audio/*" required>
                
                <span class="theme-label">SELECT VISUAL THEME</span>
                <div class="theme-selector">
                    <label class="theme-option">
                        <input type="radio" name="theme" value="theme_sunset.html" checked onchange="toggleSubOptions()">
                        <div class="theme-card">
                            <div class="theme-icon">ğŸš—</div>
                            <div class="theme-name">SUNSET DRIVE</div>
                        </div>
                    </label>
                    <label class="theme-option">
                        <input type="radio" name="theme" value="theme_studio.html" onchange="toggleSubOptions()">
                        <div class="theme-card">
                            <div class="theme-icon">ğŸ§</div>
                            <div class="theme-name">MUSIC STUDIO</div>
                        </div>
                    </label>
                    <label class="theme-option">
                        <input type="radio" name="theme" value="theme_video.html" onchange="toggleSubOptions()">
                        <div class="theme-card">
                            <div class="theme-icon">ğŸ¥</div>
                            <div class="theme-name">AI VIDEO</div>
                        </div>
                    </label>
                </div>

                <div id="sub-style-section">
                    <span class="sub-label">ENTER PROMPT FOR AI VIDEO</span>
                    <textarea id="video-prompt" rows="3" placeholder="ì›í•˜ëŠ” ì˜ìƒì˜ ìŠ¤íƒ€ì¼ì´ë‚˜ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.&#13;&#10;(ì˜ˆ: ì• ë‹ˆë©”ì´ì…˜ ëŠë‚Œì´ ë‚˜ê²Œ ë§Œë“¤ì–´ì¤˜)"></textarea>
                </div>

                <button type="submit" class="submit-btn">START VISUALIZATION</button>
            </form>
        </div>

        <div class="scroll-hint" onclick="document.getElementById('info-section').scrollIntoView({behavior: 'smooth'})">
            SCROLL FOR INFO <span>âŒ„</span>
        </div>
    </section>

    <section id="info-section">
        <div class="info-title">í…Œë§ˆ ì†Œê°œ</div>
        <div class="cards-wrapper">
            <div class="info-card card-sunset">
                <div class="card-image">
                    <div class="static-bg img-sunset"></div>
                    <img src="images/sunset.gif" class="gif-preview" alt="Sunset Theme">
                </div> 
                <div class="card-content">
                    <div class="card-title">SUNSET DRIVE</div>
                    <div class="card-desc">80ë…„ëŒ€ ì‹ ìŠ¤ì›¨ì´ë¸Œ ê°ì„±ì„ ë‹´ì•„ ë„¤ì˜¨ ê·¸ë¦¬ë“œ ìœ„ë¥¼ ì§ˆì£¼í•˜ëŠ” ìë™ì°¨ì™€ ì„ì–‘ì„ ì—°ì¶œí•˜ì—¬, ëª½í™˜ì ì´ê³  ì†ë„ê° ìˆëŠ” ë ˆíŠ¸ë¡œ ë“œë¼ì´ë¹™ ê²½í—˜ì„ ì‹œê°ì ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.</div>
                    <div class="hashtags hash-sunset">#SYNTHWAVE #80's_RETRO_STYLE #SUNSETDRIVE</div>
                </div>
            </div>
            <div class="info-card card-studio">
                <div class="card-image">
                    <div class="static-bg img-studio"></div>
                    <img src="images/studio.gif" class="gif-preview" alt="Studio Theme" onerror="this.src='images/pixel.gif'">
                </div>
                <div class="card-content">
                    <div class="card-title">MUSIC STUDIO</div>
                    <div class="card-desc">AIê°€ ë¶„ì„í•œ ìŒì•…ì˜ ë¶„ìœ„ê¸°ì— ë”°ë¼ ì°½ë°– ë°°ê²½ê³¼ ì‹¤ë‚´ ì¡°ëª…ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì‘í•˜ëŠ” ë‚˜ë§Œì˜ 3D ì‘ì—…ì‹¤ ê³µê°„</div>
                    <div class="hashtags hash-studio">#WEATHER_CHANGE #INTERACTIVE #AI_MOOD</div>
                </div>
            </div>
            <div class="info-card card-video">
                <div class="card-image">
                    <div class="static-bg img-video"></div>
                    <img src="images/video.gif" class="gif-preview" alt="AI Video Theme" onerror="this.src='images/video.gif'">
                </div>
                <div class="card-content">
                    <div class="card-title">AI VIDEO</div>
                    <div class="card-desc">ìŒì•…ì˜ ë¦¬ë“¬ê³¼ ê°ì„±ì„ AIê°€ ì™„ë²½í•˜ê²Œ í•´ì„í•˜ì—¬, ì„¸ìƒì— ë‹¨ í•˜ë‚˜ë¿ì¸ ê³ í€„ë¦¬í‹° ì˜ìƒì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒì„±í•˜ê³  ì¬ìƒí•©ë‹ˆë‹¤.</div>
                    <div class="hashtags hash-video">#GENERATIVE_AI #VIDEO_ART #HIGH_QUALITY</div>
                </div>
            </div>
        </div>
        <div class="scroll-hint" onclick="document.getElementById('team-section').scrollIntoView({behavior: 'smooth'})">
            SCROLL FOR TEAM <span>âŒ„</span>
        </div>
    </section>

    <section id="team-section">
        <div class="team-header">
            <div class="team-sub">BEAT VISUAL</div>
            <div class="team-main-title">íŒ€ì› ì†Œê°œ ë° <span>íŒŒíŠ¸ ì†Œê°œ</span></div>
        </div>
        <div class="team-grid">
            <div class="member-card card-cicd">
                <div class="member-avatar">ğŸ‘¨â€ğŸ’»</div>
                <div class="member-info">
                    <div class="member-name">ê°•ë²”ì„</div>
                    <div class="member-role role-cicd">SERVER/MONITORING</div>
                    <div class="member-contact">ğŸ“§ alvin852@naver.com</div>
                    <div class="member-contact"><a href="https://github.com/kangbum01" target="_blank">ğŸ± github.com/kangbum01</a></div>
                </div>
            </div>
            <div class="member-card card-analyze">
                <div class="member-avatar">ğŸ¬</div>
                <div class="member-info">
                    <div class="member-name">ê¹€ììœ¤</div>
                    <div class="member-role role-analyze">AI ANALYZER</div>
                    <div class="member-contact">ğŸ“§ rlawkdbs3@naver.com</div>
                    <div class="member-contact"><a href="https://github.com/JAYUN-KIM" target="_blank">ğŸ± github.com/JAYUN-KIM</a></div>
                </div>
            </div>
            <div class="member-card card-db">
                <div class="member-avatar">ğŸ‘©â€ğŸ’»</div>
                <div class="member-info">
                    <div class="member-name">ì´í•´ì—°</div>
                    <div class="member-role role-db">DB/DR SERVER</div>
                    <div class="member-contact">ğŸ“§ lhy30919@naver.com</div>
                    <div class="member-contact"><a href="https://github.com/lhy30919" target="_blank">ğŸ± github.com/lhy30919</a></div>
                </div>
            </div>
            <div class="member-card card-web">
                <div class="member-avatar">ğŸŒ</div>
                <div class="member-info">
                    <div class="member-name">ê¹€ì˜ì„±</div>
                    <div class="member-role role-web">FRONTEND</div>
                    <div class="member-contact">ğŸ“§ leokim1126@naver.com</div>
                    <div class="member-contact"><a href="https://github.com/leokim1126" target="_blank">ğŸ± github.com/leokim1126</a></div>
                </div>
            </div>
        </div>
    </section>
    
    <div id="loading-section">
        <div class="loader-text">AI ANALYZING...</div>
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAaYwHKyqkA-Mzs4DJ87H1Sn_0KGHGmFps",
            authDomain: "beat-visual.firebaseapp.com",
            projectId: "beat-visual",
            storageBucket: "beat-visual.firebasestorage.app",
            messagingSenderId: "151001850091",
            appId: "1:151001850091:web:dee4eb4453b03aa06ddeae",
            measurementId: "G-D3Z472X2V2"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        const loginBtn = document.getElementById('google-login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const userProfile = document.getElementById('user-profile');
        const userName = document.getElementById('user-name');
        const userPic = document.getElementById('user-pic');

        loginBtn.addEventListener('click', () => {
            signInWithPopup(auth, provider)
                .then((result) => {
                    console.log("Logged in:", result.user);
                }).catch((error) => {
                    console.error("Login failed:", error);
                    alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + error.message);
                });
        });

        logoutBtn.addEventListener('click', () => {
            signOut(auth).then(() => {
                console.log("Logged out");
                alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
            });
        });
        
        onAuthStateChanged(auth, (user) => {
            if (user) {
                loginBtn.style.display = 'none';
                userProfile.style.display = 'flex';
                userName.innerText = user.displayName;
                userPic.src = user.photoURL;
            } else {
                loginBtn.style.display = 'flex';
                userProfile.style.display = 'none';
                userName.innerText = "";
                userPic.src = "";
            }
        });
    </script>

    <script>
        // 1. WAS ì£¼ì†Œ ì„¤ì •
        const WAS_API_URL = '/api/jobs';
        let progressInterval = null;

        function toggleSubOptions() {
            const selectedTheme = document.querySelector('input[name="theme"]:checked').value;
            const subSection = document.getElementById('sub-style-section');
            if (selectedTheme === 'theme_video.html') {
                subSection.style.display = 'block';
            } else {
                subSection.style.display = 'none';
            }
        }

        window.addEventListener('load', function() {
            const sunsetRadio = document.querySelector('input[value="theme_sunset.html"]');
            if (sunsetRadio) sunsetRadio.checked = true;
            toggleSubOptions();
        });
        
        async function handleUpload(event) { 
            event.preventDefault(); 
            const fileInput = document.getElementById('fileInput'); 
            const file = fileInput.files[0];
            if (!file) { 
                alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); 
                return; 
            }

            document.body.style.overflow = 'hidden';
            document.getElementById('loading-section').style.display = 'flex'; 
            startLoadingAnimation();

            fetchAndStart(file); 
        }

        function startLoadingAnimation() {
            const bar = document.getElementById('progress-bar');
            let width = 0;
            if(progressInterval) clearInterval(progressInterval);
            progressInterval = setInterval(() => {
                if (width < 90) { 
                    width += 0.2; 
                    if(bar) bar.style.width = width + '%'; 
                }
            }, 100);
        }

        // [1ë‹¨ê³„] WASì— íŒŒì¼ ì—…ë¡œë“œ
        async function fetchAndStart(file) { 
            try { 
                console.log("1. WAS ì„œë²„ë¡œ íŒŒì¼ ì „ì†¡ ì¤‘...");

                const formData = new FormData();
                formData.append("file", file);

                const selectedTheme = document.querySelector('input[name="theme"]:checked').value;
                let version = "1";
                if (selectedTheme === 'theme_sunset.html') version = "1";
                else if (selectedTheme === 'theme_studio.html') version = "2";
                else if (selectedTheme === 'theme_video.html') version = "3";

                formData.append("version", version);

                let promptText = "";
                if (version === "3") {
                    promptText = document.getElementById('video-prompt').value;
                    if (promptText.trim() !== "") {
                        formData.append("user_request", promptText);
                    }
                }

                const res = await fetch(WAS_API_URL, {
                    method: 'POST',
                    body: formData
                }); 

                if (!res.ok) throw new Error(`WAS ì—…ë¡œë“œ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${res.status})`);

                const wasResponse = await res.json();
                const jobId = wasResponse.job_id || wasResponse.task_id;
                
                if (!jobId) throw new Error("WASì—ì„œ Job IDë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤!");

                console.log(`ì ‘ìˆ˜ ì™„ë£Œ! ì‘ì—… ID: ${jobId}`);
                
                // 2ë‹¨ê³„: WAS ê²°ê³¼ ìˆ˜ì‹  ëŒ€ê¸°
                pollWasForResult(jobId, selectedTheme, promptText, version);

            } catch (e) {
                console.error("================================");
                console.error("ğŸš¨ í†µì‹  ì—ëŸ¬ ë°œìƒ!");
                console.error(e);
                console.error("================================");
            } 
        }

        // [2ë‹¨ê³„] WAS í´ë§
        function pollWasForResult(jobId, selectedTheme, promptText, version) {
            const pollUrl = `${WAS_API_URL}/${jobId}`;
            const resultsUrl = `${pollUrl}/results`;
            console.log("2. WAS ê²°ê³¼ ëŒ€ê¸° ì¤‘...", pollUrl);

            const pollTimer = setInterval(async () => {
                try {
                    const response = await fetch(pollUrl);

                    if (response.status === 404) {
                        console.log("ì‘ì—…ì„ ì°¾ëŠ” ì¤‘... (ì•„ì§ ìƒì„±ë˜ì§€ ì•ŠìŒ)");
                        return;
                    }
                    if (!response.ok) {
                        console.log("ê²°ê³¼ ëŒ€ê¸° ì¤‘... (Status:", response.status, ")");
                        return;
                    }

                    const job = await response.json();

                    // ì§„í–‰ì¤‘ ìƒíƒœ
                    if (job.status === "PENDING" || job.status === "QUEUED" || job.status === "PROCESSING") {
                        console.log("ì§„í–‰ì¤‘:", job.status);
                        return;
                    }

                    // ì‹¤íŒ¨
                    if (job.status === "FAIL") {
                        clearInterval(pollTimer);
                        clearInterval(progressInterval);
                        alert(`ë¶„ì„ ì‹¤íŒ¨: ${job.error || job.error_message || "unknown"}`);
                        return;
                    }

                    // ì™„ë£Œ
                    if (job.status === "DONE") {
                        const r2 = await fetch(resultsUrl);
                        if (!r2.ok) {
                            console.log("DONE but results not ready:", r2.status);
                            return;
                        }

                        const results = await r2.json();
                        const urls = results.urls || {};

                        clearInterval(pollTimer);
                        clearInterval(progressInterval);
                        document.getElementById('progress-bar').style.width = '100%';

                        // ë¶„ì„ JSONì´ ìˆìœ¼ë©´ ê°€ì ¸ì˜¤ê¸°
                        let analysis = {};
                        if (urls.json) {
                            try {
                                const aj = await fetch(urls.json);
                                if (aj.ok) analysis = await aj.json();
                            } catch (e) {
                                console.warn("analysis json fetch failed:", e);
                            }
                        }

                        // â˜… [ìˆ˜ì • ì™„ë£Œ] ìš”ì²­í•˜ì‹  JSON êµ¬ì¡°ì— ë§ì¶”ì–´ í‰íƒ„í™” ë§µí•‘
                        const finalData = {
                            bpm: analysis.basic_metrics.bpm || 120,
                            energy: analysis.mood_and_vibe.energy_score || 50,
                            brightness: analysis.mood_and_vibe.brightness_score || 50,
                            topGenre: analysis.ai_top_predictions[0].label || "Unknown",
                            probability: analysis.ai_top_predictions[0].probability || 100,
                            videoUrl: urls.mp4 || null, 
                            audioUrl: urls.audio || null,
                            userPrompt: (promptText || "").trim(),
                            version: version
                        };

                        console.log("âœ… ì „ë‹¬ë  ìµœì¢… ë°ì´í„°:", finalData);

                        localStorage.setItem('visualData', JSON.stringify(finalData));
                        setTimeout(() => { window.location.href = selectedTheme; }, 300);
                    }

                } catch (error) {
                    console.error("WAS í™•ì¸ ì¤‘ ì—ëŸ¬:", error);
                }
            }, 3000);
        }
    </script>
</body>
</html>
