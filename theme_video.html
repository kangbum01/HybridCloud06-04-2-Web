<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>VISUALIZER: AI VIDEO</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;900&display=swap');

        body { margin: 0; overflow: hidden; background: #000; font-family: 'Montserrat', sans-serif; cursor: pointer; }
        
        /* Ìôà Î≤ÑÌäº */
        .back-btn { 
            position: absolute; top: 20px; right: 20px; z-index: 100; 
            padding: 10px 20px; background: rgba(255, 255, 255, 0.1); 
            border: 1px solid rgba(255,255,255,0.5); color: #fff; 
            border-radius: 20px; cursor: pointer; transition: 0.3s;
            text-decoration: none; font-size: 14px; font-weight: bold;
        }
        .back-btn:hover { background: #fff; color: #000; }

        /* Î∞∞Í≤Ω ÎπÑÎîîÏò§ */
        #bg-video {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: 1; opacity: 0.8; 
            filter: contrast(1.1) saturate(1.1); 
        }

        /* Í≤∞Í≥º Ï†ïÎ≥¥ UI (Í∏∞Î≥∏ opacity 0) */
        #result-ui { position: absolute; width: 100%; height: 100%; z-index: 50; pointer-events: none; opacity: 0; transition: opacity 1s; }
        
        .vibe-badge { 
            position: absolute; bottom: 40px; left: 40px; 
            color: #fff; font-size: 3em; font-weight: 900; 
            mix-blend-mode: screen; text-shadow: 0 0 20px rgba(0,255,0,0.5);
            text-transform: uppercase;
        }
        .vibe-sub { font-size: 14px; display: block; margin-top: 5px; opacity: 0.8; letter-spacing: 2px; }
        
        .music-stats { 
            position: absolute; bottom: 130px; left: 45px; 
            text-align: left; font-family: 'Courier New', monospace; 
        }
        .stat-row { margin-bottom: 6px; color: rgba(255, 255, 255, 0.6); font-size: 12px; letter-spacing: 1px; }
        .stat-value { color: #00ff00; font-weight: bold; font-size: 14px; margin-left: 10px; word-break: break-all; max-width: 400px; display: inline-block; vertical-align: top;}

        /* ÏãúÏûë Ïò§Î≤ÑÎ†àÏù¥ */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            cursor: pointer; transition: opacity 0.8s;
        }
        .start-title { color: #fff; font-size: 40px; font-weight: 900; letter-spacing: 5px; margin-bottom: 10px; }
        .start-sub { color: #00ff00; font-size: 14px; letter-spacing: 2px; animation: blink 1.5s infinite; margin-bottom: 30px; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* Ï†ïÎ≥¥ ÌëúÏãú Ï≤¥ÌÅ¨Î∞ïÏä§ Ïä§ÌÉÄÏùº */
        .option-container { display: flex; align-items: center; gap: 10px; pointer-events: auto; }
        .option-label { color: #888; font-size: 12px; letter-spacing: 1px; transition: 0.3s; }
        input[type="checkbox"] { accent-color: #00ff00; cursor: pointer; width: 16px; height: 16px; }
        input[type="checkbox"]:checked + .option-label { color: #00ff00; font-weight: bold; }

        /* Ïò§ÎîîÏò§ Ïà®ÍπÄ */
        #audio-player { display: none; }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">üè† HOME</a>

    <div id="start-overlay" onclick="startExperience()">
        <div class="start-title">AI VIDEO</div>
        <div class="start-sub">CLICK TO PLAY</div>
        
        <div class="option-container" onclick="event.stopPropagation()">
            <input type="checkbox" id="show-info-check">
            <label for="show-info-check" class="option-label">SHOW PROMPT INFO</label>
        </div>
    </div>

    <video id="bg-video" loop muted playsinline></video>

    <audio id="audio-player" src="./music_project/test.mp3" loop></audio>

    <div id="result-ui">
        <div id="music-stats-container" class="music-stats">
            <div class="stat-row">USER PROMPT <span id="info-prompt" class="stat-value">LOADING...</span></div>
            <div class="stat-row">SOURCE <span id="info-url" class="stat-value" style="font-size: 10px;">LOADING...</span></div>
        </div>
        <div id="vibe-display" class="vibe-badge">GENERATED BY AI</div>
    </div>

    <script>
        // ============================================================
        // ‚òÖ 0. Ï†ÑÏó≠ Î≥ÄÏàò
        // ============================================================
        const audioPlayer = document.getElementById('audio-player');
        const videoPlayer = document.getElementById('bg-video');
        const startOverlay = document.getElementById('start-overlay');
        const resultUi = document.getElementById('result-ui');
        const infoCheckbox = document.getElementById('show-info-check');

        // ============================================================
        // ‚òÖ 1. Îç∞Ïù¥ÌÑ∞ Î°úÎìú Î∞è UI ÏóÖÎç∞Ïù¥Ìä∏ (ÏÉà Íµ¨Ï°∞ Ï†ÅÏö©)
        // ============================================================
        // index.htmlÏóêÏÑú ÎÑòÍ≤®Ï§Ä S3 URLÍ≥º ÌîÑÎ°¨ÌîÑÌä∏ Îç∞Ïù¥ÌÑ∞Î•º Í∫ºÎÉÖÎãàÎã§.
        let aiData = JSON.parse(localStorage.getItem('visualData'));

        // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ Í≤ΩÏö∞ Î∞©Ïñ¥Ï†Å Í∏∞Î≥∏Í∞í
        if (!aiData || !aiData.videoUrl) {
            aiData = {
                videoUrl: "./music_project/video_default.mp4", // Í∏∞Î≥∏ ÏÉòÌîå ÎπÑÎîîÏò§
                userPrompt: "No prompt provided"
            };
        }

        renderUI(aiData);

        function renderUI(data) {
            // S3 ÏòÅÏÉÅ Ï£ºÏÜåÎ•º video ÌÉúÍ∑∏Ïóê ÍΩÇÏïÑ ÎÑ£ÏäµÎãàÎã§.
            videoPlayer.src = data.videoUrl;
            
            // ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûÖÎ†•ÌñàÎçò ÌîÑÎ°¨ÌîÑÌä∏ÏôÄ ÏòÅÏÉÅ Ï∂úÏ≤ò(S3 Ï£ºÏÜå)Î•º ÌôîÎ©¥Ïóê ÎùÑÏõåÏ§çÎãàÎã§.
            const promptText = data.userPrompt ? data.userPrompt : "AUTO GENERATED";
            document.getElementById('info-prompt').innerText = `"${promptText}"`;
            document.getElementById('info-url').innerText = data.videoUrl;
        }

        // ============================================================
        // ‚òÖ 2. ÏãúÏûë Î°úÏßÅ (Ï≤¥ÌÅ¨Î∞ïÏä§ ÌôïÏù∏)
        // ============================================================
        function startExperience() {
            startOverlay.style.opacity = '0';
            setTimeout(() => { startOverlay.style.display = 'none'; }, 800);
            
            // Ï≤¥ÌÅ¨Î∞ïÏä§Í∞Ä Ï≤¥ÌÅ¨ÎêòÏñ¥ ÏûàÏùÑ ÎïåÎßå Ï†ïÎ≥¥Ï∞Ω(ÌîÑÎ°¨ÌîÑÌä∏ ÎÇ¥Ïö©) ÌëúÏãú
            if (infoCheckbox.checked) {
                resultUi.style.opacity = '1';
                videoPlayer.style.opacity = '0.6'; // Í∏ÄÏî® Ïûò Î≥¥Ïù¥Í≤å ÏòÅÏÉÅ Ïñ¥Îë°Í≤å
            } else {
                resultUi.style.opacity = '0';
                videoPlayer.style.opacity = '1.0'; // ÏòÅÏÉÅÎßå Î≥º Îïê Î∞ùÍ≤å
            }
            
            // ÏùåÏïÖÍ≥º S3ÏóêÏÑú Î∂àÎü¨Ïò® AI ÏòÅÏÉÅÏùÑ ÎèôÏãúÏóê Ïû¨ÏÉù
            audioPlayer.play().catch(e => console.log("Audio play error", e));
            videoPlayer.play().catch(e => console.log("Video play error", e));
        }
    </script>
</body>
</html>